{% extends 'core/base.html' %}
{% block content %}
<div class="container">
    <h1 class="mt-5">Text Formatter</h1>
    <form method="post" class="needs-validation" novalidate>
        {% csrf_token %}
        {% load form_tags %}

        <div class="form-group row">
            <div class="col-md-4">
                <h3>Input from WhatsApp</h3>
                <button type="button" class="btn btn-primary mt-2 btn-sm mb-2" onclick="copyToClipboard('input')">
                    <i class="fas fa-copy"></i> Copy
                </button>
                <textarea class="form-control mt-2" id="input" rows="20"></textarea>
            </div>
            <div class="col-md-4">
                <h3>Output Telegram</h3>
                <button type="button" class="btn btn-primary mt-2 btn-sm mb-2" onclick="copyToClipboard('telegram')">
                    <i class="fas fa-copy"></i> Copy
                </button>
                <textarea class="form-control mt-2" id="telegram" rows="20"></textarea>
            </div>
            <div class="col-md-4">
                <h3>Output Web Narasi</h3>
                <button type="button" class="btn btn-primary mt-2 btn-sm mb-2" onclick="copyToClipboard('web')">
                    <i class="fas fa-copy"></i> Copy
                </button>
                <p class="form-control mt-2" id="web" style="border: none;"></p>
            </div>
        </div>

</div>

<!-- Toast Notification -->
<div class="toast" id="copyToast" style="position: absolute; bottom: 20px; right: 20px;" data-delay="300">
    <div class="toast-header">
        <strong class="mr-auto">Notification</strong>
        <button type="button" class="ml-2 mb-1 close" data-dismiss="toast">&times;</button>
    </div>
    <div class="toast-body" id="toastBody">
        Text copied to clipboard!
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    // replace the * in the input text to ** when the input changes, use vanilla js
    document.getElementById('input').addEventListener('input', function () {
        let input = document.getElementById('input').value;

        // Clean newlines that contain only spaces
        input = input.replace(/^\s*[\r\n]/gm, '\n');

        let telegram = input.replace(/\*/g, '**').replace(/\_/g, '__').replace('infobmkg.**', 'infobmkg.*');
        document.getElementById('telegram').value = telegram;

        // Change the input text format to HTML format
        // Replace *bold* with <strong></strong>
        let web = input.replace(/\*(.+?)\*/g, '<strong>$1</strong>');

        // Add two new lines after the second line
        web = web.replace(/^((?:.*\n){2})/, '$1<br><br>');

        // Make the first line center-aligned
        web = web.replace(/^(.*?)(\n|$)/, '<p style="text-align: center;  margin-bottom: 0;">$1</p>');

        // Make all paragraphs justify-aligned except the subtitle (bold text)
        web = web.replace(/^(?!<strong>)(.+?)(\n|$)/gm, '<p style="text-align: justify; margin-bottom: 0;">$1</p>');

        // Replace _italic_ with <em></em> (if you need italics)
        web = web.replace(/\_(.+?)\_/g, '<em>$1</em>');

        // Replace newline characters with <br> for line breaks
        web = web.replace(/\n/g, '<br>');
        document.getElementById('web').innerHTML = web;
    });

    // copy the text to clipboard
    function copyToClipboard(elementId) {
        var copyText = document.getElementById(elementId);
        if (elementId === 'web') {
            var range = document.createRange();
            range.selectNode(copyText);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand("copy");
            window.getSelection().removeAllRanges();
        } else {
            copyText.select();
            document.execCommand("copy");
        }
        // Update toast message
        var toastBody = document.getElementById('toastBody');
        toastBody.innerText = elementId.charAt(0).toUpperCase() + elementId.slice(1) + ' text copied to clipboard!';
        // Show toast notification
        $('#copyToast').toast('show');
    }
</script>
{% endblock %}