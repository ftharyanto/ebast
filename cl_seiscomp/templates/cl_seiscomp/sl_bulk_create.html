{% extends 'core/base.html' %}
{% block title %}Bulk Create Stations{% endblock %}

{% block content %}
<div class="form-container">
    <h1 class="page-header">Bulk Create Stations</h1>
    <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
        {% csrf_token %}
        <div class="form-group">
            <label for="csv_file">Upload CSV file</label>
            <input type="file" class="form-control-file" id="csv_file" name="csv_file">
            <div class="invalid-feedback">
                Please upload a CSV file.
            </div>
        </div>
        <div class="form-group">
            <label for="csv_data">Or paste CSV data</label>
            <textarea class="form-control" id="csv_data" name="csv_data" rows="5"></textarea>
            <div class="invalid-feedback">
                Please provide valid CSV data.
            </div>
        </div>
        <div class="form-group">
            <div class="alert alert-info">
                <h5><i class="fas fa-info-circle"></i> Required CSV Header Format</h5>
                <p><strong>Your CSV file must include this exact header as the first row:</strong></p>
                <div class="bg-light p-2 border rounded">
                    <code style="font-size: 1.1em; font-weight: bold; color: #d73527;">network,code,province,location,digitizer_type,UPT,longitude,latitude</code>
                </div>
                <p class="mt-3 mb-2"><strong>Example data rows:</strong></p>
                <pre class="bg-light p-2 border rounded">NET1,ST01,Province1,Location1,Type1,UPT1,106.8456,-6.2088
NET2,ST02,Province2,Location2,Type2,UPT2,107.6191,-6.9175</pre>
                <p class="mt-2 mb-0"><small><em>Note: longitude and latitude should be numeric values (decimals allowed)</em></small></p>
            </div>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="remove_existing" name="remove_existing">
                <label class="form-check-label" for="remove_existing">
                    <strong>Remove all existing stations before adding new ones</strong>
                </label>
            </div>
            <small class="form-text text-muted">
                <i class="fas fa-exclamation-triangle text-warning"></i> 
                <strong>Warning:</strong> If checked, this will permanently delete all existing stations in the database before adding the new stations from your CSV file.
            </small>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
        <a href="{% url 'cl_seiscomp:station_list' %}" class="btn btn-secondary">Cancel</a>
    </form>

    <script>
        // Example starter JavaScript for disabling form submissions if there are invalid fields
        (function () {
            'use strict';
            window.addEventListener('load', function () {
                var forms = document.getElementsByClassName('needs-validation');
                var validation = Array.prototype.filter.call(forms, function (form) {
                    form.addEventListener('submit', function (event) {
                        var fileInput = document.getElementById('csv_file');
                        var textArea = document.getElementById('csv_data');
                        if (!fileInput.value && !textArea.value.trim()) {
                            event.preventDefault();
                            event.stopPropagation();
                            fileInput.setCustomValidity('Please upload a CSV file or provide CSV data.');
                            textArea.setCustomValidity('Please upload a CSV file or provide CSV data.');
                        } else {
                            fileInput.setCustomValidity('');
                            textArea.setCustomValidity('');
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();
    </script>
</div>
{% endblock %}
